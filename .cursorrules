# Antigravity IDE Rules - GenAI Academy Frontend

You are an expert senior frontend engineer working on the GenAI Academy project.
This is a **STRICTLY FRONTEND** repository.

## 1. Project Context & Architecture
- **Type**: Frontend Web Application.
- **Framework**: React Router v7.
- **Build Tool**: Vite.
- **Deployment**: Vercel (India Region).
- **Backend**: Hono (External, deployed on DigitalOcean).
- **Database & Auth**: Supabase (External).
- **Strict Constraint**: **NEVER** write backend code, database queries, or API routes (Next.js style `api/` folders) in this repository. All logic must be client-side or consume the external Hono API.

## 2. Tech Stack & Standards
- **Package Manager**: **ALWAYS** use `bun`. Do not use `npm`, `yarn`, or `pnpm`.
- **Language**: TypeScript (Strict mode). Use `import type` for types.
- **Styling**: Tailwind CSS v4. Use utility classes. Avoid custom CSS files.
- **UI Components**: Shadcn UI (Radix Primitives).
- **Icons**: `lucide-react`.
- **State Management**: `@tanstack/react-query` (React Query) for server state.
- **Forms**: `react-hook-form` + `zod` validation.
- **Date Handling**: `date-fns`.
- **Toast Notifications**: `sonner`.
- **Drag & Drop**: `@dnd-kit` (Core, Sortable, Utilities).

## 3. Coding Rules & Patterns

### API Communication
- **Mandatory Client**: **ALWAYS** use the centralized `api` client from `app/lib/api.client.ts` (e.g., `api.get`, `api.post`). **NEVER** use raw `fetch` in components.
- **Global Error Handling**: 401 Unauthorized errors are handled globally by `QueryClient`. Do not manually catch 401s unless specific local logic is required.
- **Response Format**: Handle responses following the standard format: `{ success: boolean, message?: string, data?: any, error?: string }`.
- **Authentication**: The `api` client automatically handles the `Authorization` header when the token is passed.

### State Management (React Query)
- Use `useQuery` for fetching data.
- Use `useMutation` for modifying data (POST, PUT, DELETE).
- **Query Keys**: **ALWAYS** use the centralized `queryKeys` factory from `app/lib/query-keys.ts`. Do not hardcode query key strings.
- **Invalidation**: Always invalidate relevant query keys (e.g., `queryClient.invalidateQueries({ queryKey: queryKeys.users.all })`) after a successful mutation.
- **Stale Data**: Use `refetchOnMount: true` for lists that need to reflect immediate changes after navigation (e.g., returning from a detail page after an edit).
- **Optimistic Updates**: Implement optimistic updates for UI interactions that require immediate feedback (e.g., drag-and-drop reordering, toggle switches) before the API call completes.
- **Granular Fetching**: For nested lists (e.g., sections -> chapters), prefer fetching child data per parent item using `useQueries` or similar patterns to allow for targeted cache invalidation and updates.

### Navigation & Routing
- Use `<Link>` from `react-router` for all internal navigation. **NEVER** use `<a>` tags for internal links as they cause full page reloads.
- **Sidebar Logic**: **NEVER** hardcode `isActive: true` in sidebar navigation data. Expansion must be dynamic based on the current URL (use `useLocation`).

### UI & Accessibility
- **High Contrast**: Ensure interactive elements (like checkboxes) have sufficient contrast against their background.
- **Conditional Styling**: When using colored row highlights (e.g., for banned users), adjust child element styles (borders, backgrounds) to ensure visibility.
- **Icon-Only Buttons**: **ALWAYS** provide an `aria-label` for buttons that only contain an icon to ensure accessibility for screen readers.
- **Form Inputs**: Use `onBlur` for saving text field changes to avoid excessive API calls, while updating local state immediately for responsiveness.

### Component Structure
- Use Functional Components with Hooks.
- Co-locate related components if they are specific to a route.
- Use `export default` for Route components (pages).
- Use named exports for reusable UI components.
- Follow the `app/` directory structure: `routes`, `components`, `hooks`, `lib`.

### Type Definitions
- **Centralized Types**: Define shared types (especially API responses) in `app/types/<feature>.ts` (e.g., `app/types/course.ts`). Avoid large inline type definitions in components.


### Admin Panel Patterns
- **CRUD Structure**:
    - **List Page**: `/admin/<feature>` (Table with pagination/search).
    - **Create Page**: `/admin/<feature>/create` (Separate page for complex forms).
    - **Details Page**: `/admin/<feature>/:id` (Read-only view with actions).
    - **Edit/Delete**: Use **Dialogs** (`Edit<Feature>Dialog`, `Delete<Feature>Dialog`) triggered from the Details or List page.
- **Reusable Dialogs**: Extract complex dialogs into `app/components/admin/<feature>/`.
- **Search Components**: Use `shadcn/ui` Popover + Command for searchable dropdowns.
- **Folder Structure**: Keep admin components organized by feature.

### Shadcn UI & Icons
- **Installation**: If a component is missing, install it using `bunx --bun shadcn@latest add <component-name>`.
- **Icons**: Use `lucide-react` for all icons.

### Routing
- **Registration**: **ALWAYS** register new routes in `app/routes.ts` immediately after creating the page component. Failure to do so will result in 404s.

### Supabase Integration
- Use the exported `supabase` client from `app/lib/supabase.ts`.
- **Security**: Do not use Supabase Admin SDK or service keys in this repo. Client-side keys (`ANON_KEY`) only.
- **Environment Variables**: Use `import.meta.env.VITE_*` for client-side variables. **NEVER** expose `SUPABASE_SERVICE_ROLE_KEY` to the client.

### SEO & Meta Tags
- **Page Titles**: Ensure every route (or the root layout) defines a `meta` export with a `title` to prevent missing `<title>` element issues.

## 4. Performance Optimization
- **Virtualization**: Use `@tanstack/react-virtual` for long lists (e.g., Users table, Courses table) to ensure high performance.
- **Lazy Loading**: Use `React.lazy` and `Suspense` for heavy UI components (e.g., `Calendar`, complex Dialogs) that are not immediately visible.
- **Image Optimization**: **ALWAYS** use the `OptimizedImage` component (`app/components/optimized-image.tsx`) for images. Ensure `loading="lazy"` and `decoding="async"` are used.
- **Debouncing**: Use `useDebounce` hook (`app/hooks/use-debounce.ts`) for search inputs and filters to prevent excessive API calls.
- **Memoization**: Use `React.memo`, `useMemo`, and `useCallback` appropriately to prevent unnecessary re-renders, especially in lists and tables.
- **Prefetching**: Implement prefetching on hover (e.g., `onMouseEnter`) for critical navigation links to improve perceived speed.

## 5. Vercel Deployment Optimization
- **Configuration**: Ensure `vite.config.ts` and `react-router.config.ts` are optimized for Vercel.
- **Presets**: **ALWAYS** use `vercelPreset()` in `react-router.config.ts`.
- **Sourcemaps**: Disable sourcemaps for SSR builds (`sourcemap: !isSsrBuild`) in `vite.config.ts` to prevent build reporting errors.
- Do not include heavy server-side dependencies that bloat the client bundle.
- Respect the `build` script: `bun run build` (aliased to `react-router build`).

## 6. Agent Behavior
- **Proactive Fixes**: If you see unused imports or type errors in files you are editing, fix them.
- **Verification**: After implementing a feature, verify it doesn't break the build (`bun run build`) or typecheck (`bun run typecheck`).
- **Conciseness**: Write clean, readable code. Avoid over-engineering.
